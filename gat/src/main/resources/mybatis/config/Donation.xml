<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="donation">
	<!-- 신청서 insert -->
 	<insert id="addApplication" parameterType="applicationPostVO">
 		<selectKey keyProperty="appNo" resultType="string" order="BEFORE">
			select
			application_seq.nextval from dual
		</selectKey>
 		insert into application(
 		app_no, 
 		app_title, 
 		app_summery,
 		app_contents,
 		app_place,
 		app_imgdirectory,
 		goal_mileage,
 		start_date,
 		end_date,
 		app_status, 
 		id)
 		values(#{appNo}, 
 		#{appTitle}, 
 		#{appSummery},
 		#{appContents},
 		#{place},
 		#{imgDirectory},
 		#{goalMileage},
 		#{startDate},
 		#{endDate},
 		'처리중',
 		#{memberVO.id})
 	</insert>
 	<!-- 선물 리스트 입력 -->
 	<insert id="addPresent" parameterType="presentVO">
 		insert into present(present_no, donation_mileage, present_contents, app_no) 
 		values(present_seq.nextval, #{donationMileage}, #{presentContents}, #{appNo})
 	</insert>
 	<!-- 신청서 보기 -->
 	<!-- <select id="readDonationDetail" resultType="donationPostVO">
 		select dp_no, dp_title, dp_contents, dp_regdate, dp_place, dp_count, goal_mileage, donation_mileage, total_entry 
		from donation_post where dp_no=#{value}
 	</select> -->
 	<select id="readDonationDetail" resultType="donationPostVO">
 		
 	</select>
 	
 	<!-- 일반 재능기부 게시판 view -->
 	<select id="DonationListView" resultType="map" parameterType="donationPostPagingBean">
 		SELECT d.dp_no, d.dp_title, d.dp_summery, d.dp_imgdirectory, d.dp_count, d.dp_status, a.id FROM(
		SELECT row_number() over(order by dp_no desc) as rnum, dp_no, dp_title, 
		dp_summery, dp_imgdirectory, dp_count, dp_status, app_no
		FROM donation_post
		) d ,application a where d.app_no=a.app_no and rnum between #{startRowNumber} and #{endRowNumber} 
		order by dp_no desc
 	</select>
 	<!-- 재능기부 스크롤 페이징 게시판 -->
 	<select id="DonationListView2" resultType="map">
		SELECT row_number() over(order by dp_no desc) as rnum, dp_no, dp_title, 
		dp_summery, dp_imgdirectory, dp_count, dp_status, app_no
		FROM donation_post
 	</select>
 	
 	<!-- 재능기부 리스트 상위 3명  -->
 	<select id="DonationListRank" resultType="map">
		<![CDATA[select d.dp_no, total_entry, d.dp_title, d.dp_summery, d.dp_imgdirectory, d.dp_count, d.dp_status, d.app_no
		from(
		select  RANK() OVER (ORDER BY total_entry desc) as rank, dp_no,total_entry, dp_title, dp_summery, dp_imgdirectory, dp_count, dp_status, app_no
		from donation_post
		) d where rank <=3
		]]>
 	</select>
 	
</mapper>
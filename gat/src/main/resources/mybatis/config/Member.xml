<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	<resultMap type="memberVO" id="memberRM">
		<result property="memberGroupVO.mgroupNo" column="mgroup_no" />
		<result property="memberGroupVO.mgroupName" column="mgroup_name" />
		<result property="memberGradeVO.mgradeNo" column="mgrade_no"/>
		<result property="memberGradeVO.mgradeName" column="mgrade_name"/>
	</resultMap>
	<resultMap type="reviewPostVO" id="reviewPostRM">
		<result property="reviewPostVO.rpNO" column="rp_no"/>
		<result property="reviewPostVO.rpTitle" column="rp_title"/>
		<result property="reviewPostVO.rpContents" column="rp_contents"/>
		<result property="reviewPostVO.rpRegdate" column="rp_regdate"/>
		<result property="reviewPostVO.rpRate" column="rp_rate"/>
	</resultMap>
 	<insert id="registerMember" parameterType="memberVO">
 		insert into gt_member(id,password,name,address,email,birthday,mgroup_no,mgrade_no)
		values(#{id}, #{password}, #{name}, #{address}, #{email}, #{birthday}, 1, 1)
 	</insert>
 	<select id ="checkId" parameterType="string" resultMap="memberRM">
	<!-- 	기존 방식 쿼리 
	select m.id, m.password, m.name, m.address, m.email, m.birthday, m.mileage, m.total_use_mileage as totalUseMileage,
	gro.mgroup_no, gro.mgroup_name, gra.mgrade_no, gra.mgrade_name
	from gt_member m, MEMBER_GROUP gro, MEMBER_GRADE gra
	where m.mgroup_no=gro.mgroup_no
	and m.mgrade_no=gra.mgrade_no
	and m.id= #{value}  -->
	<!--  inner join 쿼리  -->
	select m.id, m.password, m.name, m.address, m.email, m.birthday, m.mileage, m.total_use_mileage as totalUseMileage,
	gro.mgroup_no, gro.mgroup_name, gra.mgrade_no, gra.mgrade_name
	from gt_member m
	inner join member_group gro on m.mgroup_no=gro.mgroup_no
	inner join member_grade gra on m.mgrade_no=gra.mgrade_no
	and m.id=#{value}
 	</select>
 	<update id="updatePassword" parameterType="memberVO">
 		update GT_MEMBER set password=#{password}
		where id=#{id}
 	</update>
 	<update id="updateMember" parameterType="memberVO">
 		update GT_MEMBER set address=#{address}, email=#{email}
		where id=#{id}
 	</update>
 	<update id="deleteMember" parameterType="string">
 		update GT_MEMBER set mgroup_no = '5'
		where id = #{value}
 	</update>
 	 <update id="addMemberMileage" parameterType="mileageTradeVO">
 		update GT_MEMBER set mileage=mileage + #{mtVolume} where id =#{memberVO.id}
 	</update>
 		<!-- 나의 후기 전체 후기글 수 가져오기 -->
 	<select id="totalMyReviewPostCount" resultType="int">
 		select count(*) from
		review_post
 	</select>
 	<select id="readMyReviewPostList" resultMap="reviewPostRM" parameterType="reviewPostPagingBean">
 		select r.rp_no,r.rp_title,r.rp_regdate from(
		select row_number() over (order by rp_no desc) as rnum,rp_no,rp_title,to_char(rp_regdate,'YYYY,MM,DD') as rp_regdate,id
		from REVIEW_POST
		where id=#{value}
		) r, GT_MEMBER m
		where r.id=m.id and rnum between #{startRowNumber} and #{endRowNumber}
		order by r.rp_no desc
 	</select>
 	 <update id="exchangeMemberMileage" parameterType="mileageTradeVO">
 		update GT_MEMBER set mileage=mileage - #{mtVolume} where id =#{memberVO.id}
 	</update>
</mapper>
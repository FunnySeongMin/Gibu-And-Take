<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="entry" >
 	<insert id="addTakeDonation" parameterType="takeDonationPostVO">
 		<selectKey keyProperty="tdNo" resultType="int" order="BEFORE">
 			select take_donation_seq.nextval from dual
 		</selectKey>
 		insert into take_donation(td_no, td_regdate, td_mileage <if test="cheerUpMessage!=null">,cheerup_message</if>, id, dp_no)
 		values(#{tdNo}, sysdate, #{tdMileage} <if test="cheerUpMessage!=null">,#{cheerUpMessage}</if>, #{memberVO.id}, #{donationPostVO.dpNo})
 	</insert>
 	<resultMap type="takeDonationPostVO" id="memberRM">
 		<result column="id"  property="memberVO.id"/>
 		<result column="name"  property="memberVO.name"/>
 	</resultMap> 
 	<select id="findCheerupMessageByDpno" parameterType="string" resultType="takeDonationPostVO" resultMap="memberRM">
 		select td.td_no, td.td_regdate, td.td_mileage, td.cheerup_message, td.dp_no, td.id, m.id, m.name 
 		from take_donation td, gt_member m 
 		where td.id=m.id and dp_no=#{value}
 		order by td.td_no desc
 	</select>
 	<select id="findEntryByIdAndDpno" parameterType="takeDonationPostVO" resultType="int">
 		select count(*) from take_donation where id=#{memberVO.id} and dp_no=#{donationPostVO.dpNo}
 	</select>
</mapper>